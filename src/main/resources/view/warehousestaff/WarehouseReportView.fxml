<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<VBox xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1"
      prefHeight="650.0" prefWidth="820.0" fx:controller="controller.warehousestaff.WarehouseReportController">
    <children>
        <!-- Header -->
        <HBox alignment="CENTER" spacing="10.0" style="-fx-background-color: #2196F3; -fx-padding: 15;">
            <children>
                <Label text="WAREHOUSE REPORT" textFill="WHITE">
                    <font>
                        <Font name="System Bold" size="24.0" />
                    </font>
                </Label>
            </children>
        </HBox>

        <!-- Summary Panel -->
        <VBox fx:id="summaryBox" spacing="10.0" style="-fx-background-color: #f5f5f5; -fx-padding: 15;">
            <children>
                <HBox alignment="CENTER_LEFT" spacing="15.0">
                    <children>
                        <Label text="OVERVIEW STATISTICS" textFill="#333333">
                            <font>
                                <Font name="System Bold" size="16.0" />
                            </font>
                        </Label>
                        <Button fx:id="refreshSummaryBtn" onAction="#handleRefreshSummary" text="Refresh" />
                    </children>
                </HBox>
                <HBox spacing="30.0">
                    <children>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8;">
                            <children>
                                <Label text="Total Products" textFill="#666666">
                                    <font>
                                        <Font size="12.0" />
                                    </font>
                                </Label>
                                <Label fx:id="totalProductsLabel" text="0" textFill="#2196F3">
                                    <font>
                                        <Font name="System Bold" size="20.0" />
                                    </font>
                                </Label>
                            </children>
                        </VBox>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8;">
                            <children>
                                <Label text="Total Received" textFill="#666666">
                                    <font>
                                        <Font size="12.0" />
                                    </font>
                                </Label>
                                <Label fx:id="totalReceivedLabel" text="0" textFill="#4CAF50">
                                    <font>
                                        <Font name="System Bold" size="20.0" />
                                    </font>
                                </Label>
                            </children>
                        </VBox>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8;">
                            <children>
                                <Label text="Total Loss" textFill="#666666">
                                    <font>
                                        <Font size="12.0" />
                                    </font>
                                </Label>
                                <Label fx:id="totalLossLabel" text="0" textFill="#F44336">
                                    <font>
                                        <Font name="System Bold" size="20.0" />
                                    </font>
                                </Label>
                            </children>
                        </VBox>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8;">
                            <children>
                                <Label text="Current Stock" textFill="#666666">
                                    <font>
                                        <Font size="12.0" />
                                    </font>
                                </Label>
                                <Label fx:id="currentStockLabel" text="0" textFill="#FF9800">
                                    <font>
                                        <Font name="System Bold" size="20.0" />
                                    </font>
                                </Label>
                            </children>
                        </VBox>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8;">
                            <children>
                                <Label text="Stock Value" textFill="#666666">
                                    <font>
                                        <Font size="12.0" />
                                    </font>
                                </Label>
                                <Label fx:id="totalStockValueLabel" text="0 VND" textFill="#9C27B0">
                                    <font>
                                        <Font name="System Bold" size="16.0" />
                                    </font>
                                </Label>
                            </children>
                        </VBox>
                    </children>
                </HBox>
                <HBox spacing="20.0">
                    <children>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #ffebee; -fx-padding: 10; -fx-background-radius: 8;">
                            <children>
                                <Label text="Out of Stock" textFill="#d32f2f">
                                    <font>
                                        <Font size="12.0" />
                                    </font>
                                </Label>
                                <Label fx:id="outOfStockLabel" text="0" textFill="#d32f2f">
                                    <font>
                                        <Font name="System Bold" size="16.0" />
                                    </font>
                                </Label>
                            </children>
                        </VBox>
                        <VBox alignment="CENTER" spacing="5.0" style="-fx-background-color: #fff3e0; -fx-padding: 10; -fx-background-radius: 8;">
                            <children>
                                <Label text="Low Stock" textFill="#f57c00">
                                    <font>
                                        <Font size="12.0" />
                                    </font>
                                </Label>
                                <Label fx:id="lowStockLabel" text="0" textFill="#f57c00">
                                    <font>
                                        <Font name="System Bold" size="16.0" />
                                    </font>
                                </Label>
                            </children>
                        </VBox>
                    </children>
                </HBox>
            </children>
        </VBox>

        <!-- Tab Pane -->
        <TabPane fx:id="tabPane" VBox.vgrow="ALWAYS">
            <tabs>
                <!-- Tab 1: Inventory Report -->
                <Tab text="Inventory" closable="false">
                    <content>
                        <VBox spacing="10.0">
                            <children>
                                <!-- Control Panel -->
                                <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                                    <children>
                                        <Label text="Warning Threshold:" />
                                        <TextField fx:id="lowStockThresholdField" prefWidth="80.0" />
                                        <Button fx:id="showLowStockBtn" onAction="#handleShowLowStock" text="Show Low Stock" />
                                        <Separator orientation="VERTICAL" />
                                        <Button fx:id="refreshInventoryBtn" onAction="#handleRefreshInventory" text="All Products" />
                                    </children>
                                </HBox>

                                <!-- Inventory Table -->
                                <TableView fx:id="inventoryTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="invProductCodeCol" prefWidth="100.0" text="Product ID" />
                                        <TableColumn fx:id="invProductNameCol" prefWidth="200.0" text="Product Name" />
                                        <TableColumn fx:id="invBrandCol" prefWidth="100.0" text="Brand" />
                                        <TableColumn fx:id="invPriceCol" prefWidth="120.0" text="Price" />
                                        <TableColumn fx:id="invReceivedCol" prefWidth="80.0" text="Received" />
                                        <TableColumn fx:id="invLossCol" prefWidth="80.0" text="Loss" />
                                        <TableColumn fx:id="invCurrentStockCol" prefWidth="80.0" text="Stock" />
                                        <TableColumn fx:id="invStatusCol" prefWidth="100.0" text="Status" />
                                        <TableColumn fx:id="invValueCol" prefWidth="120.0" text="Stock Value" />
                                    </columns>
                                </TableView>
                            </children>
                            <padding>
                                <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                            </padding>
                        </VBox>
                    </content>
                </Tab>

                <!-- Tab 2: Stock Entry History -->
                <Tab text="Entry History" closable="false">
                    <content>
                        <VBox spacing="10.0">
                            <children>
                                <!-- Date Filter -->
                                <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                                    <children>
                                        <Label text="From Date:" />
                                        <DatePicker fx:id="entryFromDate" />
                                        <Label text="To Date:" />
                                        <DatePicker fx:id="entryToDate" />
                                        <Button fx:id="searchEntriesBtn" onAction="#handleSearchEntries" text="Search" />
                                    </children>
                                </HBox>

                                <!-- Stock Entry Table -->
                                <TableView fx:id="stockEntryTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="entryIdCol" prefWidth="80.0" text="Entry ID" />
                                        <TableColumn fx:id="entryDateCol" prefWidth="100.0" text="Entry Date" />
                                        <TableColumn fx:id="supplierCol" prefWidth="150.0" text="Supplier" />
                                        <TableColumn fx:id="employeeCol" prefWidth="120.0" text="Employee" />
                                        <TableColumn fx:id="totalQtyCol" prefWidth="80.0" text="Total Qty" />
                                        <TableColumn fx:id="totalValueCol" prefWidth="120.0" text="Total Value" />
                                        <TableColumn fx:id="productCountCol" prefWidth="80.0" text="Products" />
                                    </columns>
                                </TableView>
                            </children>
                            <padding>
                                <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                            </padding>
                        </VBox>
                    </content>
                </Tab>

                <!-- Tab 3: Entry Details -->
                <Tab text="Entry Details" closable="false">
                    <content>
                        <VBox spacing="10.0">
                            <children>
                                <!-- Date Filter -->
                                <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                                    <children>
                                        <Label text="From Date:" />
                                        <DatePicker fx:id="detailFromDate" />
                                        <Label text="To Date:" />
                                        <DatePicker fx:id="detailToDate" />
                                        <Button fx:id="searchDetailsBtn" onAction="#handleSearchDetails" text="Search" />
                                    </children>
                                </HBox>

                                <!-- Stock Detail Table -->
                                <TableView fx:id="stockDetailTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="detailProductCodeCol" prefWidth="100.0" text="Product ID" />
                                        <TableColumn fx:id="detailProductNameCol" prefWidth="200.0" text="Product Name" />
                                        <TableColumn fx:id="detailBrandCol" prefWidth="100.0" text="Brand" />
                                        <TableColumn fx:id="detailReceivedCol" prefWidth="80.0" text="Received" />
                                        <TableColumn fx:id="detailAvgCostCol" prefWidth="120.0" text="Avg Cost" />
                                        <TableColumn fx:id="detailTotalCostCol" prefWidth="120.0" text="Total Cost" />
                                        <TableColumn fx:id="detailEntryCountCol" prefWidth="80.0" text="Entries" />
                                    </columns>
                                </TableView>
                            </children>
                            <padding>
                                <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                            </padding>
                        </VBox>
                    </content>
                </Tab>

                <!-- Tab 4: Loss Report -->
                <Tab text="Loss Report" closable="false">
                    <content>
                        <VBox spacing="10.0">
                            <children>
                                <!-- Date Filter -->
                                <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                                    <children>
                                        <Label text="From Date:" />
                                        <DatePicker fx:id="lossFromDate" />
                                        <Label text="To Date:" />
                                        <DatePicker fx:id="lossToDate" />
                                        <Button fx:id="searchLossBtn" onAction="#handleSearchLoss" text="Search" />
                                    </children>
                                </HBox>

                                <!-- Loss Report Table -->
                                <TableView fx:id="lossTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="lossReportIdCol" prefWidth="80.0" text="Report ID" />
                                        <TableColumn fx:id="lossDateCol" prefWidth="100.0" text="Report Date" />
                                        <TableColumn fx:id="lossEmployeeCol" prefWidth="150.0" text="Employee" />
                                        <TableColumn fx:id="lossQuantityCol" prefWidth="80.0" text="Loss Qty" />
                                        <TableColumn fx:id="lossValueCol" prefWidth="120.0" text="Loss Value" />
                                        <TableColumn fx:id="lossProductCountCol" prefWidth="80.0" text="Products" />
                                    </columns>
                                </TableView>
                            </children>
                            <padding>
                                <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                            </padding>
                        </VBox>
                    </content>
                </Tab>

                <!-- Tab 5: Top Loss Products -->
                <Tab text="Top Loss" closable="false">
                    <content>
                        <VBox spacing="10.0">
                            <children>
                                <!-- Control Panel -->
                                <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                                    <children>
                                        <Label text="Display Limit:" />
                                        <TextField fx:id="topLossLimitField" prefWidth="80.0" />
                                        <Button fx:id="showTopLossBtn" onAction="#handleShowTopLoss" text="Show" />
                                    </children>
                                </HBox>

                                <!-- Top Loss Table -->
                                <TableView fx:id="topLossTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="topLossProductCodeCol" prefWidth="100.0" text="Product ID" />
                                        <TableColumn fx:id="topLossProductNameCol" prefWidth="200.0" text="Product Name" />
                                        <TableColumn fx:id="topLossBrandCol" prefWidth="100.0" text="Brand" />
                                        <TableColumn fx:id="topLossQuantityCol" prefWidth="80.0" text="Loss Qty" />
                                        <TableColumn fx:id="topLossValueCol" prefWidth="120.0" text="Loss Value" />
                                        <TableColumn fx:id="topLossPercentageCol" prefWidth="80.0" text="Loss %" />
                                    </columns>
                                </TableView>
                            </children>
                            <padding>
                                <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                            </padding>
                        </VBox>
                    </content>
                </Tab>

                <!-- Tab 6: Loss Detail Report (NEW) -->
                <Tab text="Loss Details" closable="false">
                    <content>
                        <VBox spacing="10.0">
                            <children>
                                <!-- Date Filter -->
                                <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                                    <children>
                                        <Label text="From Date:" />
                                        <DatePicker fx:id="lossDetailFromDate" />
                                        <Label text="To Date:" />
                                        <DatePicker fx:id="lossDetailToDate" />
                                        <Button fx:id="searchLossDetailBtn" onAction="#handleSearchLossDetail" text="Search" />
                                    </children>
                                </HBox>

                                <!-- Loss Detail Table -->
                                <TableView fx:id="lossDetailTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="lossDetailReportIdCol" prefWidth="80.0" text="Report ID" />
                                        <TableColumn fx:id="lossDetailProductCodeCol" prefWidth="100.0" text="Product ID" />
                                        <TableColumn fx:id="lossDetailProductNameCol" prefWidth="180.0" text="Product Name" />
                                        <TableColumn fx:id="lossDetailQuantityCol" prefWidth="80.0" text="Quantity" />
                                        <TableColumn fx:id="lossDetailReasonCol" prefWidth="120.0" text="Reason" />
                                        <TableColumn fx:id="lossDetailValueCol" prefWidth="120.0" text="Loss Value" />
                                        <TableColumn fx:id="lossDetailDateCol" prefWidth="100.0" text="Date" />
                                    </columns>
                                </TableView>
                            </children>
                            <padding>
                                <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                            </padding>
                        </VBox>
                    </content>
                </Tab>

                <!-- Tab 7: Loss Reason Report (NEW) -->
                <Tab text="Loss Reasons" closable="false">
                    <content>
                        <VBox spacing="10.0">
                            <children>
                                <!-- Date Filter -->
                                <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                                    <children>
                                        <Label text="From Date:" />
                                        <DatePicker fx:id="reasonFromDate" />
                                        <Label text="To Date:" />
                                        <DatePicker fx:id="reasonToDate" />
                                        <Button fx:id="searchReasonBtn" onAction="#handleSearchReason" text="Search" />
                                    </children>
                                </HBox>

                                <!-- Loss Reason Table -->
                                <TableView fx:id="lossReasonTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="reasonCol" prefWidth="200.0" text="Reason" />
                                        <TableColumn fx:id="reasonProductCountCol" prefWidth="100.0" text="Product Count" />
                                        <TableColumn fx:id="reasonQuantityCol" prefWidth="100.0" text="Total Quantity" />
                                        <TableColumn fx:id="reasonValueCol" prefWidth="150.0" text="Total Value" />
                                        <TableColumn fx:id="reasonReportCountCol" prefWidth="100.0" text="Report Count" />
                                    </columns>
                                </TableView>
                            </children>
                            <padding>
                                <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                            </padding>
                        </VBox>
                    </content>
                </Tab>

                <!-- Tab 8: Loss Value Comparison (NEW) -->
                <Tab text="Value Comparison" closable="false">
                    <content>
                        <VBox spacing="10.0">
                            <children>
                                <!-- Date Filter -->
                                <HBox alignment="CENTER_LEFT" spacing="15.0" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                                    <children>
                                        <Label text="From Date:" />
                                        <DatePicker fx:id="compFromDate" />
                                        <Label text="To Date:" />
                                        <DatePicker fx:id="compToDate" />
                                        <Button fx:id="searchComparisonBtn" onAction="#handleSearchComparison" text="Search" />
                                    </children>
                                </HBox>

                                <!-- Value Comparison Table -->
                                <TableView fx:id="valueComparisonTable" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="compProductCodeCol" prefWidth="100.0" text="Product ID" />
                                        <TableColumn fx:id="compProductNameCol" prefWidth="160.0" text="Product Name" />
                                        <TableColumn fx:id="compQuantityCol" prefWidth="80.0" text="Quantity" />
                                        <TableColumn fx:id="compSellingPriceCol" prefWidth="100.0" text="Selling Price" />
                                        <TableColumn fx:id="compUnitCostCol" prefWidth="100.0" text="Unit Cost" />
                                        <TableColumn fx:id="compLossBySellingCol" prefWidth="120.0" text="Loss by Selling" />
                                        <TableColumn fx:id="compLossByUnitCostCol" prefWidth="120.0" text="Loss by Cost" />
                                        <TableColumn fx:id="compValueDifferenceCol" prefWidth="120.0" text="Difference" />
                                    </columns>
                                </TableView>
                            </children>
                            <padding>
                                <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
                            </padding>
                        </VBox>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </children>
</VBox>